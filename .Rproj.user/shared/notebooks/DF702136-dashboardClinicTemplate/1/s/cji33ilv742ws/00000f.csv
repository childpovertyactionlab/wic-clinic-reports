"0","df.recent.long <- df.recent %>%"
"0","  select(-Clinic, -Manager) %>%"
"0","  pivot_longer(cols = -c(1),"
"0","               names_to = ""variable"","
"0","               values_to = ""Value"") %>%"
"0","  merge(POE, by = ""variable"") %>%"
"0","  select(Site, Value, improvement_phrase, phase)"
"0",""
"0","df.clinic_fails <- df.recent.long %>%"
"0","  filter(Site == clinic_id, Value < fail)"
"0",""
"0","fail_count <- df.clinic_fails %>%"
"0","  count(phase) %>%"
"0","  mutate(name = paste0(""Phase "", phase),"
"0","         color = palette_cpal_main[phase],"
"0","         message = glue_col(""{n} items in <span style='color:{color}'>{name}</span>"")) %>%"
"0","  pull(message)"
"0",""
"0","fail_count_string <- paste(fail_count, collapse = "", "")"
"0",""
"0","if(length(fail_count) > 1) {"
"0","  fail_count_string <- stringr::str_replace(fail_count_string, ""\\,(?=[^,]*$)"", "" and"")"
"0","}"
"0",""
"0","improves <- df.clinic_fails %>% "
"0","  { if(nrow(.) > 5) "
"0","      slice_sample(., n = 5)"
"0","    else "
"0","      ."
"0","  } %>% pull(improvement_phrase)"
"0",""
"0","improvements_string <- paste0(""\n\n - "", paste(improves, collapse = ""\n\n - ""))"
"0",""
"0","improvement_text <- knitr::asis_output(glue("
"0","  ""The {clinic_name} clinic has {knitr::asis_output(fail_count_string)} that need improvement. "
"0","  {if (length(improves) > 0) {"
"0","    paste('Here are some goals to focus on:', improvements_string)"
"0","  } else {"
"0","    'Wonderful work! You are a WIC superstar!'"
"0","  }}"""
"0","))"
"0",""
