"0","df.phase.clinic <- df.phase %>%"
"0","  # ungroup() %>%"
"0","  # mutate_if(is.numeric, ~./(ncol(.) - 2)) %>%"
"0","  filter(Site == clinic_id)"
"0",""
"0","phase_eval <- df.phase.clinic %>%"
"0","  filter(Date == max(df.phase.clinic$Date)) %>%"
"0","  ungroup() %>% select(-c(Site, Date)) %>% "
"0","  gather(key = ""phase"", value = ""metric"") %>%"
"0","  mutate(phase = gsub(""(phase)(\\d+)"", ""Phase \\2"", phase),"
"0","         evaluation = if_else(metric > threshold,"
"0","                              ""fulfilled"","
"0","                              ""not_fulfilled""))"
"0",""
"0","# create grouped phase strings"
"0","phase_eval.strong <- phase_eval %>% filter(evaluation == ""fulfilled"") %>% mutate(colored_phase = paste0(""<span style='color:"", palette_cpal_main[stringr::str_remove(phase, ""Phase "")],""'>"", phase, ""</span>"")) %>% pull(colored_phase) %>% paste(collapse = "", "")"
"0","phase_eval.weak <- phase_eval %>% filter(evaluation == ""not_fulfilled"") %>% mutate(colored_phase = paste0(""<span style='color:"", palette_cpal_main[stringr::str_remove(phase, ""Phase "")],""'>"", phase, ""</span>"")) %>% pull(colored_phase) %>% paste(collapse = "", "")"
"0",""
"0","# Use your oxford_comma function to make it look better"
"0","phase_eval.strong <- oxford_comma(strsplit(phase_eval.strong, "", "")[[1]])"
"0","phase_eval.weak <- oxford_comma(strsplit(phase_eval.weak, "", "")[[1]])"
"0",""
"0","phase_text <- paste(if (nchar(phase_eval.strong) > 0) "
"0","                             paste0(""Nice job getting "", phase_eval.strong, "" fulfillment above "", ""<span style='color:#2f2f2f'>"", sprintf(""%.f%%"", threshold*100), ""</span>"", ""!""),"
"0","                           if (nchar(phase_eval.weak) > 0) "
"0","                             paste0(""Work on getting "", phase_eval.weak, "" targets up.""))"
